<div class="orientation-issue"></div>

<table class="game-framework" ng-app="gameFrameworkApp" ng-controller="gameCtrl">
	<tbody>
		<tr>
			<td style="width: 25%">
				<table class="gf-progress">
					<tbody>
						<tr>
							<td ng-repeat="level in gf.levels" style="width: {{100/gf.levels.length}}%;" ng-class="{passed:level.passed, current:level.current}"></td>
						</tr>
					</tbody>
				</table>
			</td>
			<td>Level {{gf.currentLevel}}</td>
			<td>{{gf.score.total}} Points</td>
			<td style="text-align:right;">{{gf.globalTimer|format_time}}</td>
		</tr>
		<tr>
			<td colspan="4" class="header">
				<img src="http://www.fleetwit.com/uploads/races/regular-c59d9edf-d77e-44ef-8bc9-967e6c0c5206.png" style="width:100%;" />
			</td>
		</tr>
		<tr>
			<td colspan="4" class="content">
				<div class="game" id="game">
					<table class="screen gf-levelScore" style="display: none;" data-screenid="level-score">
						<tbody>
							<tr>
								<td>
									<div class="gf-label">
										This level: {{gf.score.current}}<br />
										Total: 		{{gf.score.total}}
									</div>
									<div class="gf-timer">3</div>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="screen gf-survey" style="display: none;" data-screenid="survey">
						<tbody>
							<tr>
								<td class="gf-main">
									<div id="survey"></div>
								</td>
							</tr>
							<tr>
								<td class="gf-footer">
									<div class="gf-btn" id="survey-submit">Continue</div>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="screen gf-end" style="display: none;" data-screenid="end">
						<tbody>
							<tr>
								<td class="gf-main">
									End of the game<br />
									Score: {{gf.score.total}}<br />
									Time: {{gf.globalTimer|format_time}}
								</td>
							</tr>
							<tr>
								<td class="gf-footer">
									<div class="gf-btn">Share</div>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</td>
		</tr>
		<tr>
			<td colspan="4" class="footer">
				<div id="game-footer"></div>
			</td>
		</tr>
	</tbody>
</table>

<script type="text/javascript">
	
	// Define the levels
	var levels = [{
		type:		"trivia",
		title:		"Trivia",
		label:		"Trivia question 1",
		time:		60,
		hint:		"This is a cool hint!",
		errors:		2,
		data:		{
			type:		"radio",
			list:		[{
				label:	"A",
				value:	"A"
			},{
				label:	"B",
				value:	"B"
			},{
				label:	"C",
				value:	"C"
			}],
			answer:		"A"
		},
		display:	{
			type:	"image",
			image:	"http://www.fleetwit.com/races/images/PeterShankman/07/image.jpg"
		}
	},{
		type:		"trivia",
		title:		"Another Trivia",
		label:		"Complete: \"Hello ____\"",
		time:		60,
		data:		{
			type:		"varchar",
			answer:		"world"
		},
		display:	{
			type:	"image",
			image:	"http://images.nationalgeographic.com/wpf/media-live/photos/000/477/overrides/lyngen-alps-aurora-1-24_47737_600x450.jpg"
		}
	},{
		type:		"trivia",
		title:		"Trivia",
		label:		"Trivia question 3",
		time:		180,
		hint:		"This is a cool hint!",
		data:		{
			type:		"radio",
			list:		[{
				label:	"A",
				value:	"A"
			},{
				label:	"B",
				value:	"B"
			},{
				label:	"C",
				value:	"C"
			}],
			answer:		"C"
		},
		display:	{
			type:	"image",
			image:	"http://www.fleetwit.com/races/images/PeterShankman/07/image.jpg"
		}
	}];
	
	
	
	var form = [{
		name:			"question_1",
		type:			"radio",
		label:			"This is a radio question",
		required:		true,
		list: [{
			value:		"A",
			label:		"Choice A"
		},{
			value:		"B",
			label:		"Choice B"
		},{
			value:		"C",
			label:		"Choice C"
		}]
	},{
		name:			"question_2",
		type:			"varchar",
		label:			"This is a varchar question",
		required:		false
	},{
		name:			"question_3",
		type:			"checkbox",
		label:			"This is a checkbox question",
		required:		true,
		list: [{
			value:		"A",
			label:		"Choice A"
		},{
			value:		"B",
			label:		"Choice B"
		},{
			value:		"C",
			label:		"Choice C"
		}]
	}];
	
	
	// Define the angular app
	angular.module('gameFrameworkApp', []).controller('gameCtrl', function($scope) {
		$(function() {
			var game = new gameFramework($("#game"), []).build({
				$scope:		$scope,
				levels:		levels,
				buttons:	$("#game-footer"),
				onInit:		function(gf) {
					console.info("onInit()");
				},
				onLevelUp:	function(gf, levelData) {
					console.info("onLevelUp()", levelData);
				},
				onFinish:	function(gf, time) {
					console.info("onFinish()", time+"ms");
				}
			});
			
			game.start();
			
			// Start the survey
			var jform = new formjs($("#survey"), ['bootstrap']).build({	// We are generating the form in the #form container
				form:		form,			// The form data
				submit:		$("#survey-submit"),	// The submit button
				onSubmit:	function(data, jform) {	// Executed when the entire form validates.
					// We use the Bootstrap plugin, telling it to reset the previous error display
					jform.bootstrap.resetErrors();
					
					game.screens.show("end");
				},
				onError:	function(data, jform) {	// Executed when at least one question didn't validate.
					// We use the Bootstrap plugin, telling it to visually show us the errors using the bootstrap theme.
					jform.bootstrap.showErrors();
					// You can manage your own error display. "data" is an array containing the list of fields that did not validate.
					// We won't do that in that example.
					alert("You have errors on the survey.");
				}
			});
		})
	}).filter('format_time', function() {
		return function(time) {
			var seconds = time/1000;
			var hours = Math.floor(seconds / 3600);
			seconds = seconds - hours * 3600;
			var minutes = (Math.floor(seconds/60) < 10) ? "0" + Math.floor(seconds/60) : Math.floor(seconds/60);
			var seconds = (seconds % 60 > 9) ? seconds % 60 : "0" + seconds % 60;
			seconds = Math.round(seconds);
			seconds = (seconds > 9) ? seconds : "0" + seconds;
			var timestring = minutes+":"+seconds;
			return timestring;
		};
	});
	
	$(function() {
		
	});
</script>