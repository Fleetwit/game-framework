(function(){var a=function(){this.games={};this.displays={};this.plugins={}};a.prototype.game=function(d,c,e){if(this.games[d]){console.info("/! Game '"+d+"' is already defined. Duplicate:",e);this.formErrors.push("/! Game '"+d+"' is already defined.");return false}else{this.games[d]=c;return true}};a.prototype.display=function(d,c,e){if(this.displays[d]){console.info("/! Display '"+d+"' is already defined. Duplicate:",e);this.formErrors.push("/! Display '"+d+"' is already defined.");return false}else{this.displays[d]=c;return true}};a.prototype.plugin=function(d,f,e,c){if(this.plugins[d]&&!c){console.info("/! Plugin '"+d+"' is already defined. Duplicate:",e);this.formErrors.push("/! Plugin '"+d+"' is already defined.");return false}else{this.plugins[d]=f;return true}};a.prototype.dom=function(c,e,d){var f=document.createElement(c);if(e!=undefined){$(e).append($(f))}return(d===true)?f:$(f)};var b=function(e,d,c){this.container=d;this.levels=[];this.data={};this.errors=[];this.formErrors=[];this.slideDuration=500;this.startPoints=1000;this.lossPerError=this.startPoints/10;this.$scope=e;this.screens=new window.screenjs(this.container);this.timer={global:new window.stopwatch(),level:new window.stopwatch()};if(c){this.use=c}else{this.use=[]}var f=this;_.each(this.use,function(g){if(window.gfFactory.plugins[g]){window.gfFactory.plugins[g](f)}else{console.error("/! Plugin '"+g+"' is missing.");this.formErrors.push("Plugin '"+g+"' is missing.")}})};b.prototype.build=function(c){var e=this;this.options=_.extend({levels:{},submit:$(),onInit:function(){console.info("GF Init")},onLevelUp:function(f){console.info("GF Level Up")},onFinish:function(){console.info("GF Finish")}},c);if(!this.$scope){console.log("AngularJS $scope not defined!");return false}var d=0;_.each(this.options.levels,function(g){if(!window.gfFactory.games[g.type]){console.info("/! Game '"+g.type+"' doesn't exist on ",g);e.formErrors.push("Game '"+g.type+"' doesn't exist.");return this}else{e.$scope.gf.levels[d]=g;e.$scope.$apply();e.screens.refresh();var f=new window.gfFactory.games[g.type](e,g);var j="level"+d;var i=e.getLayers(e.screens.get(j));if(g.label===false){i.elements.game.label.css({height:0,padding:0});i.elements.game.container.css("height","100%")}var h={level:d,factory:window.gfFactory.games[g.type],instance:f,data:_.extend({time:180},g),layers:i,errors:[],lossPerError:(e.startPoints/g.errors)||e.lossPerError,points:e.startPoints,screenid:j,built:false};e.$scope.gf.levels[d].evt_instructions={show:function(){i.show("instructions")},hide:function(){i.show("game",function(){if(!h.built){h.instance.init();h.built=true}})}};e.$scope.gf.levels[d].evt_hint={show:function(){i.show("hint")},hide:function(){i.show("game",function(){if(!h.built){h.instance.init();h.built=true}})}};if(g.display){if(!window.gfFactory.displays[g.display.type]){console.info("/! Display '"+g.display.type+"' doesn't exist on ",g);e.formErrors.push("Display '"+g.display.type+"' doesn't exist.")}else{h.display=new window.gfFactory.displays[g.display.type](e,g);h.display.build(i.elements.game.display)}}f.onError=function(k){h.errors.push(k);h.points-=h.lossPerError;h.points=Math.max(h.points,0);if(h.points==0){f.end()}};f.end=function(k){console.log("level ended");h.ended=new Date().getTime();e.timer.level.reset();e.timer.level.pause();console.log("error",h.errors,h.points);e.$scope.gf.score.current=h.points;e.$scope.gf.score.total+=h.points;e.$scope.$apply();e.screens.show("level-score");var l=new window.gf_countdown({update:function(m){e.screens.get("level-score").find(".gf-timer").html(m)},end:function(){l.stop();e.options.onLevelUp(e,h);if(h.level+1<e.levels.length){e.launch(h.level+1)}else{console.log("Game completed");e.timer.global.pause();e.options.onFinish(e,e.timer.global.current());e.screens.show("survey")}}});l.set(3);l.start()};e.levels.push(h)}d++;return this});e.$scope.$apply();e.options.onInit(this);return this};b.prototype.start=function(c){this.timer.global.start();this.launch(0)};b.prototype.launch=function(d){var c=this;if(this.levels[d]){this.currentLevel=d;this.timer.level=new window.stopwatch();this.timer.level.start();this.timer.level.addCue(this.levels[d].data.time,function(){c.levels[d].points=0;c.levels[d].instance.end()});this.levels[d].started=new Date().getTime();this.levels[d].layers.show("instructions");this.levels[d].instance.build(this.levels[d].layers);this.screens.show(this.levels[d].screenid,null,{onComplete:function(){}});this.$scope.gf.currentLevel=d+1;_.each(c.levels,function(e){if(e.level<d){c.$scope.gf.levels[e.level].passed=true;c.$scope.gf.levels[e.level].current=false}if(e.level==d){c.$scope.gf.levels[e.level].passed=false;c.$scope.gf.levels[e.level].current=true}if(e.level>d){c.$scope.gf.levels[e.level].passed=false;c.$scope.gf.levels[e.level].current=false}});clearInterval(this.levelInterval);this.levelInterval=setInterval(function(){c.$scope.gf.levelTimer=c.timer.level.current();c.$scope.gf.globalTimer=c.timer.global.current();c.$scope.$apply()},100);this.$scope.$apply()}else{this.currentLevel=false}};b.prototype.createLevelContainer=function(A){var e=this;var n=window.gfFactory.dom("div",this.container);n.addClass("screen");var k=window.gfFactory.dom("div",n);k.addClass("layers");var o=window.gfFactory.dom("table",k);o.addClass("layer").addClass("layer-instructions");var d=window.gfFactory.dom("tbody",o);var x=window.gfFactory.dom("tr",d);var s=window.gfFactory.dom("td",x);s.addClass("gf-header");var w=window.gfFactory.dom("tr",d);var p=window.gfFactory.dom("td",w);p.addClass("gf-bg");var v=window.gfFactory.dom("tr",d);var q=window.gfFactory.dom("td",v);q.addClass("gf-footer");var z=window.gfFactory.dom("div",q);z.addClass("gf-btn");z.html("Got it");z.add(p).click(function(){e.hideInstructions()});var t=window.gfFactory.dom("table",k);t.addClass("layer").addClass("layer-hint");var d=window.gfFactory.dom("tbody",t);var x=window.gfFactory.dom("tr",d);var j=window.gfFactory.dom("td",x);j.addClass("gf-bg");var w=window.gfFactory.dom("tr",d);var q=window.gfFactory.dom("td",w);q.addClass("gf-footer");var m=window.gfFactory.dom("div",q);m.addClass("gf-btn");m.html("Got it");m.add(j).click(function(){e.hideHint()});var c=window.gfFactory.dom("table",k);c.addClass("layer").addClass("layer-game");var d=window.gfFactory.dom("tbody",c);var x=window.gfFactory.dom("tr",d);var r=window.gfFactory.dom("td",x);r.addClass("gf-display");r.attr("colspan",2);var w=window.gfFactory.dom("tr",d);var l=window.gfFactory.dom("td",w);l.addClass("gf-label");l.attr("colspan",2);var v=window.gfFactory.dom("tr",d);var y=window.gfFactory.dom("td",v);y.addClass("gf-game");y.attr("colspan",2);var u=window.gfFactory.dom("tr",d);var i=window.gfFactory.dom("td",u);i.addClass("gf-footer");i.css("width","50%");var h=window.gfFactory.dom("div",i);h.addClass("gf-btn").addClass("gf-secondary").css("border-right",0);h.html("How to play");h.click(function(){e.showInstructions()});var g=window.gfFactory.dom("td",u);g.addClass("gf-footer");g.css("width","50%");var f=window.gfFactory.dom("div",g);f.addClass("gf-btn").addClass("gf-secondary");f.html("Hint");f.click(function(){e.showHint()});return{container:n,layer:{game:c,instructions:{container:o,bg:p,header:s},hint:{container:t,bg:j}},label:l,display:r,game:y}};b.prototype.getLayers=function(d){var c={};c.elements={};var e=$();d.find("[data-layerid]").each(function(f,g){c[$(g).attr("data-layerid")]=$(g);e=e.add($(g));c.elements[$(g).attr("data-layerid")]={};$(g).find("[data-element]").each(function(h,i){c.elements[$(g).attr("data-layerid")][$(i).attr("data-element")]=$(i)})});c.show=function(g,f){e.fadeOut();c[g].fadeIn(function(){if(f){f()}})};return c};b.prototype.showPenalty=function(f,c){if(!f){var f=3}var e=this;this.screens.show("penalty");var d=new window.gf_countdown({update:function(g){e.screens.get("penalty").find(".gf-timer").html(g)},end:function(){d.stop();c();e.screens.back()}});d.set(f);d.start()};b.prototype.createButtons=function(e){var d=this;var c={};_.each(e,function(g){var f=window.gfFactory.dom("div",d.options.buttons);f.addClass("btn").addClass("btn-primary");f.html(g.label);f.click(g.onClick);f.hide();c[g.name]=f});return c};b.prototype.stringify=function(d){var c=[];_.each(this.options.levels,function(e){var f=_.extend({},e);c.push(f)});if(d){return JSON.stringify(c,null,4)}else{return JSON.stringify(c)}};window.gfFactory=new a();window.gameFramework=b})();(function(){var a=function(b,d){var c=this;this.gf=b;this.data=d};a.prototype.build=function(c){var b=this;console.info("Building level.");this.layers=c;c.instructions.addClass("game-trivia");switch(this.data.data.type){default:case"radio":c.elements.instructions.container.addClass("instruction-tap");break;case"varchar":c.elements.instructions.container.addClass("instruction-input");break}this.formjs=new window.formjs(this.layers.elements.game.container,["bootstrap"]).build({showLabel:false,form:[_.extend({},this.data.data,{name:"question",required:true})],onSubmit:function(e,d){b.layers.elements.game.container.removeClass("has-error");if(e.question.toLowerCase()==b.data.data.answer.toLowerCase()){b.end()}else{$("input").blur();b.layers.elements.game.container.addClass("has-error");b.gf.showPenalty(3,function(){b.onError(e.question)})}},onChange:function(e,d){b.formjs.submit()},onError:function(e,d){console.log("Error!",e,d);b.layers.elements.game.container.removeClass("has-error");b.layers.elements.game.container.addClass("has-error");b.gf.showPenalty()}})};a.prototype.init=function(){console.info("Game initialized.");this.formjs.focus()};a.prototype.hide=function(){};window.gfFactory.game("trivia",a,{description:"Trivia, a FormJS adapter.",version:1,author:"Julien Loutre <julien@twenty-six-medias.com>"})})();(function(){var a=function(b,d){var c=this;this.gf=b;this.data=d};a.prototype.build=function(d){var c=this;d.instructions.addClass("game-scramble");d.elements.instructions.container.addClass("instruction-tap");var b=gameElements.container(d.elements.game.container);b.css("margin","10px");this.word=this.data.data.word.split("");this.display=_.shuffle(this.word);this.letters_display=gameElements.letterGroup(b,{number:this.display.length,onClick:function(e,g,f){c.letters_display.empty(e);c.letters_random.push(g);c.check()}});this.letters_random=gameElements.letterGroup(b,{letters:this.display,onClick:function(e,g,f){c.letters_random.empty(e);c.letters_display.push(g);c.check()}})};a.prototype.check=function(){var d;var c=0;var b=0;for(d=0;d<this.word.length;d++){var e=this.letters_display.get(d);if(e!=""){if(e==this.word[d]){this.letters_display.reset(d);c++}else{this.letters_display.wrong(d);b++;if(b==1){console.log("onError",this.letters_display.get());this.onError(this.letters_display.get())}}}}if(this.letters_display.get()==this.word.join("")){this.end()}};a.prototype.init=function(){};a.prototype.hide=function(){};window.gfFactory.game("scramble",a,{description:"Scramble",version:1,author:"Julien Loutre <julien@twenty-six-medias.com>"})})();(function(){var a=function(b,d){var c=this;this.gf=b;this.data=d;this.data.data=_.extend({width:4,height:4},this.data.data)};a.prototype.build=function(f){var e=this;f.instructions.addClass("game-memory");f.elements.instructions.container.addClass("instruction-tap");var c=gameElements.container(f.elements.game.container,{square:true});c.parent().css("padding","10px");this.grid=gameElements.grid(c,{width:this.data.data.width,height:this.data.data.height,square:true});this.images=new Array();this.found=new Array();this.turnedStack=new Array();this.locked=false;var d;for(d=0;d<(this.data.data.width*this.data.data.height/2);d++){this.images.push("pic"+(d+1)+".png");this.images.push("pic"+(d+1)+".png")}var b;var g;for(g=0;g<this.data.data.height;g++){for(b=0;b<this.data.data.width;b++){this.initImage(b,g)}}};a.prototype.initImage=function(h,g){var i=this;var b=this.getRandomImage();var c=window.gfFactory.dom("div",this.grid.get(h,g));c.css({width:"100%",height:"100%"});var j=window.gfFactory.dom("img",c);j.attr("src",this.data.data.images+"pic0.png");j.attr("data-screenid","cover");var e=window.gfFactory.dom("img",c);e.attr("src",this.data.data.images+b);e.attr("data-screenid","image");c.addClass("screen");this.grid.get(h,g).css({padding:"1px"});var d=new window.screenjs(c);d.show("cover");var f={screenjs:d,x:h,y:g,src:b,turned:false,found:false};this.grid.get(h,g).data("memory-data",f);j.click(function(){if(i.locked||i.turnedStack.length>=2||f.turned){return false}i.turnedStack.push(f);if(i.turnedStack.length==2){i.locked=true}d.show("image","top",{onComplete:function(){f.turned=true;if(i.turnedStack.length==2&&i.turnedStack[1].x==f.x&&i.turnedStack[1].y==f.y){if(i.turnedStack[0].src==i.turnedStack[1].src){i.locked=false;i.turnedStack[0].found=true;i.turnedStack[1].found=true;i.found.push(i.turnedStack[1].src);i.turnedStack=[];if(i.found.length==(i.data.data.width*i.data.data.height/2)){i.end()}}else{i.turnedStack[0].screenjs.show("cover",null,{onComplete:function(){}});i.turnedStack[1].screenjs.show("cover",null,{onComplete:function(){i.locked=false}});i.turnedStack[0].turned=false;i.turnedStack[1].turned=false;i.turnedStack=[];i.onError(false)}}}})})};a.prototype.getRandomImage=function(){var e=this;var b=this.images.length;var d=Math.floor((Math.random()*b+Math.random()*b)/2);var c=this.images[d].toString();this.images.splice(d,1);return c};a.prototype.init=function(){var c=this;var e=0;this.locked=true;var b;var d;for(d=0;d<this.data.data.height;d++){for(b=0;b<this.data.data.width;b++){(function(f,g){setTimeout(function(){c.grid.get(f,g).data("memory-data").screenjs.show("image");setTimeout(function(){c.grid.get(f,g).data("memory-data").screenjs.show("cover",null,{onComplete:function(){e++;if(e==(c.data.data.width*c.data.data.height/2)){c.locked=false}}})},3000)},Math.random()*1500)})(b,d)}}};a.prototype.hide=function(){};window.gfFactory.game("memory",a,{description:"Memory",version:1,author:"Julien Loutre <julien@twenty-six-medias.com>"})})();(function(){var a=function(b,d){var c=this;this.gf=b;this.data=d};a.prototype.build=function(c){var b=this;console.log("layers",c);c.instructions.addClass("game-wordsearch");c.game.addClass("game-wordsearch");c.elements.instructions.container.addClass("instruction-tap");this.container=gameElements.container(c.elements.game.container,{square:true});this.container.addClass("ge-grid");this.container.parent().css("padding","10px");this.listContainer=window.gfFactory.dom("div",c.elements.game.container);this.listContainer.css("margin-top","5px")};a.prototype.init=function(){var b=this;console.log("Words: ",this.data.data.words);this.container.game_words({words:this.data.data.words,listContainer:this.listContainer,onEnd:function(){console.log("FOUND!");b.end()},onError:function(c){console.log("error",c);b.onError(c)}})};a.prototype.hide=function(){};window.gfFactory.game("wordsearch",a,{description:"Wordsearch",version:1,author:"Julien Loutre <julien@twenty-six-medias.com>"})})();(function(){var a=function(b,d){var c=this;this.gf=b;this.data=d};a.prototype.build=function(d){var c=this;d.instructions.addClass("game-hangman");d.elements.instructions.container.addClass("instruction-tap");var b=gameElements.container(d.elements.game.container);b.css("margin","10px");this.word=this.data.data.word.split("");this.counter=0;this.letters_display=gameElements.letterGroup(b,{number:this.word.length,onClick:function(e,g,f){}});this.keyboard=gameElements.keyboard(d.elements.game.container,{layout:"qwerty",onClick:function(g,f){if(c.counter<8){if(_.contains(c.word,g)){var e;for(e=0;e<c.word.length;e++){if(c.word[e].toLowerCase()==g.toLowerCase()){c.letters_display.set(e,g.toUpperCase());c.counter++}}c.keyboard.inset(g);c.check()}else{c.keyboard.wrong(g);c.onError(g)}}if(c.counter==8){c.keyboard.disable()}}});this.keyboard.element.css("margin-top","10px")};a.prototype.check=function(){var d;var c=0;var b=0;for(d=0;d<this.word.length;d++){var e=this.letters_display.get(d);if(e!=""){if(e==this.word[d]){this.letters_display.reset(d);c++}else{this.letters_display.wrong(d);b++;if(b==1){this.onError(this.letters_display.get())}}}}if(this.letters_display.get()==this.word.join("")){this.end()}};a.prototype.init=function(){};a.prototype.hide=function(){};window.gfFactory.game("hangman",a,{description:"Hangman",version:1,author:"Julien Loutre <julien@twenty-six-medias.com>"})})();(function(){var a=function(b,d){var c=this;this.gf=b;this.data=d;this.data.data=_.extend({words:["hello|world","I love|javascript"]},this.data.data);this.found=0};a.prototype.build=function(d){var b=this;d.instructions.addClass("game-brokenword");d.game.addClass("game-brokenword");this.words=[];_.each(this.data.data.words,function(e){b.words.push(e.split("|"))});d.elements.instructions.container.addClass("instruction-tap");this.container=gameElements.container(d.elements.game.container);this.container.parent().css("padding","10px");this.drop_containers=$();this.wordlist=gameElements.wordlist(this.container);_.each(this.words,function(f){var e=gameElements.wordpart(b.container,{empty:"drop here"}).set(0,f[0]);b.drop_containers=b.drop_containers.add(e.get(1));e.get(1).data("word",f[1]);e.get(1).data("wordpart",e)});_.each(this.words,function(g){var e=b.wordlist.addWord(g[1]);e.element.css("cursor","move");var h=false;var f=new gameElements.drag({element:e.element,target:b.drop_containers,parent:b.container,onStart:function(){console.log("Starting the drag...")},onDrag:function(){console.log("Dragging...")},onEnd:function(){console.log("...And we're done.")},onDrop:function(i){if(i.data("word")==g[1]){i.data("wordpart").set(1,g[1]);e.empty();f.remove();b.found++;if(b.found==b.data.data.words.length){b.end()}}else{b.gf.showPenalty(3,function(){b.onError([g[0],i.data("word")])})}}})});this.wordlist.shuffle();var c=window.gfFactory.dom("div",this.container);c.addClass("clearfix")};a.prototype.init=function(){var b=this};a.prototype.hide=function(){};window.gfFactory.game("brokenword",a,{description:"Brokenword",version:1,author:"Julien Loutre <julien@twenty-six-medias.com>"})})();(function(){var a=function(b,d){var c=this;this.gf=b;this.data=d;this.data.data=_.extend({images:[]},this.data.data);this.found=0};a.prototype.build=function(f){var b=this;f.instructions.addClass("game-imagelabel");f.game.addClass("game-imagelabel");f.elements.instructions.container.addClass("instruction-tap");this.container=gameElements.container(f.elements.game.container);this.drop_containers=$();this.wordlist=gameElements.wordlist(this.container);this.grid=gameElements.grid(this.container,{width:2,height:2});var d={0:[0,0],1:[1,0],2:[0,1],3:[1,1]};var c=0;_.each(this.data.data.images,function(k){var i=b.wordlist.addWord(k.label);i.element.css("cursor","move").css("z-index","1000");var g=b.grid.get(d[c][0],d[c][1]);g.css("padding","2px");var h=gameElements.imageContainer(g,{src:k.image,autosize:true});h.container.data("img",k.image);b.drop_containers=b.drop_containers.add(h.container);var l=false;var j=new gameElements.drag({element:i.element,target:b.drop_containers,parent:b.container,onStart:function(){console.log("Starting the drag...")},onDrag:function(){console.log("Dragging...")},onEnd:function(){console.log("...And we're done.")},onDrop:function(m){console.log("Dropped!",m);if(m.is(h.container)){i.empty();j.remove();b.found++;h.label(k.label);if(b.found==b.data.data.images.length){b.end()}}else{b.gf.showPenalty(3,function(){b.onError([k.label,m.data("img")])})}}});c++});this.wordlist.shuffle();var e=window.gfFactory.dom("div",this.container);e.addClass("clearfix")};a.prototype.init=function(){var b=this};a.prototype.hide=function(){};window.gfFactory.game("imagelabel",a,{description:"Imagelabel",version:1,author:"Julien Loutre <julien@twenty-six-medias.com>"})})();(function(){window.gfFactory.plugin("fleetwit",function(a){},{description:"Fleetwit: idk yet",version:1,author:"Julien Loutre <julien@fleetwit.com>"})})();(function(){var a=function(b,c){this.gf=b;this.data=c};a.prototype.build=function(b){this.container=b;this.img=window.formjsFactory.dom("img",b);this.img.css("width","100%");this.img.attr("src",this.data.display.image)};a.prototype.init=function(){};a.prototype.hide=function(){};window.gfFactory.display("image",a,{description:"Display a static adaptive image",version:1,author:"Julien Loutre <julien@fleetwit.com>"})})();